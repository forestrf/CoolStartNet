<!DOCTYPE html>
<html>
<head>
	<script src="../js/epiceditor/js/epiceditor.min.js"></script>
	<script src="../js/prettify/prettify.js"></script>
	<script src="../js/crel2.js"></script>
	<script src="functions.js"></script>
	<script src="doc.js"></script>
	<link rel="stylesheet" type="text/css" href="../css/reset.css"/>
	<link rel="stylesheet" type="text/css" href="../js/prettify/prettify.css"/>
	<style>
		#list {
			width: 20%;
			height: 100%;
			overflow: auto;
			position: absolute;
		}
		#list input {
			display: block;
		}
		#list .container {
			background-color: rgba(0, 0, 0, 0.1);
			margin-left: 10px;
		}
		#list .elem {
			color: #000;
		}
		#list .elem span {
			cursor: pointer;
			float: right;
		}
		#list .elem .up {
			background-color: #000;
			color: #00FF00;
		}
		#list .elem .down {
			background-color: #000;
			color: #FFFF00;
		}
		#list .elem .delete {
			background-color: #000;
			color: #FF0000;
		}
		#list .attribute {
			color: #00f;
			cursor: pointer;
		}
		
		#content {
			right: 0;
			width: 80%;
			height: 100%;
			overflow: auto;
			position: absolute;
		}
	</style>
</head>
<body>
	<div id="list"></div>
	<div id="content">
		<div id="previewer"></div>
		
		<input type="button" value="Write data to JSON" id="button_save"></input>
		<input type="button" value="Generate JSON" onclick="recalc_DOC()"></input>
		<br/>
		<textarea id="txt" style="width:100%;height:20em;"></textarea>
	</div>
<script>
	var C = crel2;
	
	function recalc_DOC(){
		document.getElementById("txt").value = JSON.stringify(DOC);
	}
	
	var previewer;

	// https://github.com/OscarGodson/EpicEditor/issues/147#issuecomment-19862743
	var editor = new EpicEditor({
		container: 'previewer',
		basePath: '../js/epiceditor',
		localStorageName: 'epiceditor',
		useNativeFullscreen: true,
		theme: {
			base: '/themes/base/epiceditor.css',
			preview: '/themes/preview/github.css',
			editor: '/themes/editor/epic-dark.css'
		},
		autogrow: true
	}).load(function() {
		previewer = this.getElement('previewer');

		// Prettify JS
		var scriptTag = previewer.createElement('script');
		scriptTag.src = '../js/prettify/prettify.js';

		// Prettify CSS
		var cssTag = previewer.createElement('link');
		cssTag.rel = 'stylesheet';
		cssTag.type = 'text/css';
		cssTag.href = '../js/prettify/prettify.css';

		// Add JS / CSS
		previewer.body.appendChild(scriptTag);
		previewer.head.appendChild(cssTag);
	});

	editor.on('preview', function() {
		// Add necessary classes to <code> elements
		var previewerBody = previewer.body;
		var codeBlocks = previewerBody.getElementsByTagName('code');

		for (var i = 0; i < codeBlocks.length; i++)
			codeBlocks[i].className += ' prettyprint';

		prettyPrint(null, previewerBody);
	});
	
	
	
	
	document.getElementById("list").appendChild(recursive_list_fill(DOC, "object"));
	
	function recursive_list_fill(doc, type){
		var obj = C("div");
		
		var types = info[type];
		
		for(var i in types){
			var buttonEdit = C('span', i);
			C(obj, C("div", ["class", "attribute"], buttonEdit));
			if(types[i] instanceof Array){
				var button = C("input", ["type", "button", "value", "Add to "+i]);
				obj.appendChild(button);
			} else {
				buttonEdit.onclick = (function(doc, i){
					return function(){
						editor.importFile("", doc[i].replace(/\t/g, "    "));
						document.getElementById("button_save").onclick = function(){
							doc[i] = editor.exportFile().replace(/    /g, "\t");
							if(doc[i].lastIndexOf("\n") === doc[i].length -1){
								doc[i] = doc[i].substr(0, doc[i].length -1);
							}
						}
					}
				})(doc, i);
			}
			
			var d = doc[i];
			if(d && d instanceof Array){
				for(var j = 0; j < d.length; j++){
					var buttonUp = C('span', ["class", "up"], "up");
					var buttonDown = C('span', ["class", "down"], "down");
					var buttonDelete = C('span', ["class", "delete"], "delete");
					var elem = C("div", ["class", "elem"], d[j].name, buttonUp, buttonDown, buttonDelete);
					obj.appendChild(
						C("div", ["class", "container"], elem, recursive_list_fill(d[j], types[i][0]))
					);
				}
			}
		}
		return obj;
	}
	
	
	
	
</script>
</body>
</html>